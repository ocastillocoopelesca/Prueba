<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prueba de velocidad de red Puerto 24 Switch 1 Patch Panel 3</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #00a8cc 0%, #0891b2 50%, #0e7490 100%);
    min-height: 100vh;
    padding: 20px;
}
.container {
    max-width: 1600px;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.98);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}
.header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 4px solid #00a8cc;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border-radius: 15px;
    padding: 30px;
}
.coopelesca-logo {
    color: #00a8cc;
    font-size: 3em;
    font-weight: bold;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0,168,204,0.3);
}
.header h1 {
    color: #0e7490;
    font-size: 2em;
    margin-bottom: 5px;
}
.header h2 {
    color: #0891b2;
    font-size: 1.5em;
    margin-bottom: 10px;
    font-weight: normal;
}
.version-badge {
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: bold;
    display: inline-block;
    margin-top: 10px;
}
.company-info {
    background: linear-gradient(135deg, #00a8cc 0%, #0891b2 100%);
    color: white;
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 30px;
    text-align: center;
}
.company-info h3 {
    font-size: 1.3em;
    margin-bottom: 15px;
}
.company-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 15px;
}
.company-item {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 10px;
    backdrop-filter: blur(10px);
}
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
}
.stat-card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    text-align: center;
    border-left: 5px solid #00a8cc;
    transition: transform 0.3s ease;
}
.stat-card:hover {
    transform: translateY(-5px);
}
.stat-value {
    font-size: 1.8em;
    font-weight: bold;
    color: #0891b2;
    margin-bottom: 5px;
}
.stat-label {
    color: #0e7490;
    font-size: 0.85em;
    font-weight: 600;
}
.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}
.chart-card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-top: 4px solid #00a8cc;
}
.chart-title {
    font-size: 1.2em;
    color: #0e7490;
    margin-bottom: 15px;
    text-align: center;
    font-weight: bold;
}
canvas {
    max-height: 350px !important;
}
.data-table {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin-top: 30px;
}
.table-header {
    background: linear-gradient(135deg, #00a8cc 0%, #0891b2 100%);
    color: white;
    padding: 20px;
    font-size: 1.2em;
    font-weight: bold;
    text-align: center;
}
.table-content {
    max-height: 500px;
    overflow-y: auto;
}
table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid #e0f2fe;
}
th {
    background: linear-gradient(135deg, #00a8cc 0%, #0891b2 100%);
    color: white;
    position: sticky;
    top: 0;
    font-weight: bold;
    z-index: 10;
}
tr:hover {
    background: #f0f9ff;
}
td {
    color: #0e7490;
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="coopelesca-logo">üåê COOPELESCA R.L.</div>
<img src="assets/R1-PP3-D24.jpg" alt="Puerto R1-PP3-D24" style="max-width: 400px; height: auto; margin: 15px auto; display: block; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
<h1>Prueba de velocidad de red Puerto 24 Switch 1 Patch Panel 3</h1>
<h2>Centro de Operaciones de Red - Unidad de Ingenier√≠a</h2>
</div>

<div class="company-info">
<h3>üìä Informaci√≥n de la prueba</h3>
<div class="company-details">
<div class="company-item"><strong>Servidor:</strong> 192.168.55.19:5201</div>
<div class="company-item"><strong>Prueba de Ping hacia:</strong> 8.8.8.8</div>
<div class="company-item"><strong>Protocolo (TCP, UDP):</strong> AMBOS</div>
<div class="company-item"><strong>Inicio:</strong> 2025-11-28 13:27:18</div>
<div class="company-item"><strong>Fin:</strong> 2025-11-28 13:30:34</div>
<div class="company-item"><strong>Intervalo:</strong> 45 seg</div>
</div>
</div>

<div id="stats" class="stats-grid"></div>

<div class="charts-container" id="charts"></div>

<div class="data-table">
<div class="table-header">üìã Registro Detallado de Mediciones</div>
<div class="table-content">
<table>
<thead id="tableHead"></thead>
<tbody id="dataTable"></tbody>
</table>
</div>
</div>
</div>

<script>
const proto = 'AMBOS';
const pingHost = '8.8.8.8';
const coopelescaColors = {
    primary: '#00a8cc',
    secondary: '#0891b2',
    tertiary: '#0e7490',
    success: '#22c55e',
    danger: '#e74c3c',
    warning: '#f39c12'
};

function hexToRgba(hex, alpha) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + alpha + ')';
}

const baseChartConfig = {
    type: 'line',
    options: {
        responsive: true,
        maintainAspectRatio: true,
        interaction: {
            mode: 'index',
            intersect: false
        },
        plugins: {
            legend: { display: false },
            tooltip: {
                backgroundColor: 'rgba(0, 168, 204, 0.9)',
                titleColor: 'white',
                bodyColor: 'white',
                borderColor: '#00a8cc',
                borderWidth: 2
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { color: coopelescaColors.tertiary },
                grid: { color: 'rgba(0, 168, 204, 0.1)' }
            },
            x: {
                ticks: { color: coopelescaColors.tertiary },
                grid: { color: 'rgba(0, 168, 204, 0.1)' }
            }
        },
        elements: {
            line: {
                tension: 0.4,
                borderWidth: 3
            },
            point: {
                radius: 4,
                hoverRadius: 7,
                borderWidth: 2,
                backgroundColor: 'white'
            }
        }
    }
};

const charts = {};
let dataPoints = [];

function createChart(id, title, color) {
    const canvas = document.createElement('canvas');
    canvas.id = id;
    const card = document.createElement('div');
    card.className = 'chart-card';
    card.innerHTML = '<div class="chart-title">' + title + '</div>';
    card.appendChild(canvas);
    document.getElementById('charts').appendChild(card);
    
    const bgColor = color.startsWith('#') ? hexToRgba(color, 0.1) : color.replace('rgb', 'rgba').replace(')', ', 0.1)');
    
    return new Chart(canvas, {
        ...baseChartConfig,
        data: {
            labels: [],
            datasets: [{
                data: [],
                borderColor: color,
                backgroundColor: bgColor,
                fill: true,
                pointBackgroundColor: 'white',
                pointBorderColor: color
            }]
        }
    });
}

function initCharts() {
    if (proto === 'TCP' || proto === 'AMBOS') {
        charts.tcp_dl = createChart('tcpDlChart', 'üì• TCP Descarga (Mbps)', coopelescaColors.primary);
        charts.tcp_ul = createChart('tcpUlChart', 'üì§ TCP Subida (Mbps)', coopelescaColors.secondary);
        charts.tcp_retrans_dl = createChart('tcpRetransDl', 'üîÑ Retransmisiones TCP DL', coopelescaColors.warning);
        charts.tcp_retrans_ul = createChart('tcpRetransUl', 'üîÑ Retransmisiones TCP UL', '#f39c12');
    }
    
    if (proto === 'UDP' || proto === 'AMBOS') {
        charts.udp_dl = createChart('udpDlChart', 'üì• UDP Descarga (Mbps)', coopelescaColors.success);
        charts.udp_ul = createChart('udpUlChart', 'üì§ UDP Subida (Mbps)', '#16a34a');
        charts.udp_jitter_dl = createChart('udpJitterDl', '‚è±Ô∏è Jitter UDP DL (ms)', '#3b82f6');
        charts.udp_jitter_ul = createChart('udpJitterUl', '‚è±Ô∏è Jitter UDP UL (ms)', '#2563eb');
        charts.udp_loss_dl = createChart('udpLossDl', 'üìâ P√©rdida UDP DL (%)', coopelescaColors.danger);
        charts.udp_loss_ul = createChart('udpLossUl', 'üìâ P√©rdida UDP UL (%)', '#dc2626');
    }
    
    charts.ping = createChart('pingChart', 'üèì Latencia Ping ' + pingHost + ' (ms)', coopelescaColors.tertiary);
    charts.ping_loss = createChart('pingLossChart', 'üìâ P√©rdida Ping ' + pingHost + ' (%)', coopelescaColors.danger);
}

function addDataPoint(data) {
    dataPoints.push(data);
}

function renderCharts() {
    if (dataPoints.length === 0) {
        document.body.innerHTML = '<h1 style="text-align:center;margin-top:50px;color:white;">Sin datos para mostrar</h1>';
        return;
    }
    
    dataPoints.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
    
    const totals = {};
    Object.keys(charts).forEach(k => totals[k] = 0);
    
    dataPoints.forEach(data => {
        const timeLabel = new Date(data.timestamp).toLocaleTimeString();
        
        Object.keys(charts).forEach(chartKey => {
            if (data[chartKey] !== undefined && data[chartKey] !== null) {
                charts[chartKey].data.labels.push(timeLabel);
                const val = parseFloat(data[chartKey]) || 0;
                charts[chartKey].data.datasets[0].data.push(val);
                totals[chartKey] += val;
            }
        });
    });
    
    Object.values(charts).forEach(c => c.update());
    
    const n = dataPoints.length;
    let statsHtml = '<div class="stat-card"><div class="stat-value">' + n + '</div><div class="stat-label">Mediciones</div></div>';
    
    if (proto === 'TCP' || proto === 'AMBOS') {
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.tcp_dl/n).toFixed(2) + '</div><div class="stat-label">TCP DL Promedio (Mbps)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.tcp_ul/n).toFixed(2) + '</div><div class="stat-label">TCP UL Promedio (Mbps)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + Math.round(totals.tcp_retrans_dl) + '</div><div class="stat-label">Retrans TCP DL Total</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + Math.round(totals.tcp_retrans_ul) + '</div><div class="stat-label">Retrans TCP UL Total</div></div>';
    }
    
    if (proto === 'UDP' || proto === 'AMBOS') {
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.udp_dl/n).toFixed(2) + '</div><div class="stat-label">UDP DL Promedio (Mbps)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.udp_ul/n).toFixed(2) + '</div><div class="stat-label">UDP UL Promedio (Mbps)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.udp_jitter_dl/n).toFixed(3) + '</div><div class="stat-label">Jitter DL Prom (ms)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.udp_jitter_ul/n).toFixed(3) + '</div><div class="stat-label">Jitter UL Prom (ms)</div></div>';
    }
    
    statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.ping/n).toFixed(2) + '</div><div class="stat-label">Ping Promedio (ms)</div></div>';
    statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.ping_loss/n).toFixed(2) + '</div><div class="stat-label">P√©rdida Ping Prom (%)</div></div>';
    
    document.getElementById('stats').innerHTML = statsHtml;
    
    let thHtml = '<tr><th>Hora</th>';
    if (proto === 'TCP' || proto === 'AMBOS') {
        thHtml += '<th>TCP DL (Mbps)</th><th>TCP UL (Mbps)</th><th>Retrans DL</th><th>Retrans UL</th>';
    }
    if (proto === 'UDP' || proto === 'AMBOS') {
        thHtml += '<th>UDP DL (Mbps)</th><th>UDP UL (Mbps)</th><th>Jitter DL (ms)</th><th>Jitter UL (ms)</th><th>Loss DL (%)</th><th>Loss UL (%)</th>';
    }
    thHtml += '<th>Ping (ms)</th><th>Loss (%)</th></tr>';
    document.getElementById('tableHead').innerHTML = thHtml;
    
    const tbody = document.getElementById('dataTable');
    tbody.innerHTML = '';
    for (let i = dataPoints.length - 1; i >= 0; i--) {
        const d = dataPoints[i];
        let row = '<tr><td>' + new Date(d.timestamp).toLocaleString() + '</td>';
        if (proto === 'TCP' || proto === 'AMBOS') {
            row += '<td>' + (d.tcp_dl || 0).toFixed(2) + '</td>';
            row += '<td>' + (d.tcp_ul || 0).toFixed(2) + '</td>';
            row += '<td>' + Math.round(d.tcp_retrans_dl || 0) + '</td>';
            row += '<td>' + Math.round(d.tcp_retrans_ul || 0) + '</td>';
        }
        if (proto === 'UDP' || proto === 'AMBOS') {
            row += '<td>' + (d.udp_dl || 0).toFixed(2) + '</td>';
            row += '<td>' + (d.udp_ul || 0).toFixed(2) + '</td>';
            row += '<td>' + (d.udp_jitter_dl || 0).toFixed(3) + '</td>';
            row += '<td>' + (d.udp_jitter_ul || 0).toFixed(3) + '</td>';
            row += '<td>' + (d.udp_loss_dl || 0).toFixed(2) + '</td>';
            row += '<td>' + (d.udp_loss_ul || 0).toFixed(2) + '</td>';
        }
        row += '<td>' + (d.ping || 0).toFixed(2) + '</td>';
        row += '<td>' + (d.ping_loss || 0).toFixed(2) + '</td></tr>';
        tbody.innerHTML += row;
    }
}

initCharts();

addDataPoint({timestamp:'2025-11-28 13:27:18',tcp_dl:935.660000,tcp_ul:946.090000,tcp_retrans_dl:0.000000,tcp_retrans_ul:110.000000,udp_dl:956.570000,udp_ul:956.780000,udp_jitter_dl:0.029617,udp_jitter_ul:0.022178,udp_loss_dl:0.077042,udp_loss_ul:0.209846,ping:45.784000,ping_loss:0.000000});
addDataPoint({timestamp:'2025-11-28 13:28:03',tcp_dl:938.480000,tcp_ul:938.770000,tcp_retrans_dl:0.000000,tcp_retrans_ul:105.000000,udp_dl:956.510000,udp_ul:956.590000,udp_jitter_dl:0.012565,udp_jitter_ul:0.014126,udp_loss_dl:0.089574,udp_loss_ul:0.234421,ping:44.281000,ping_loss:0.000000});
addDataPoint({timestamp:'2025-11-28 13:28:48',tcp_dl:937.770000,tcp_ul:941.880000,tcp_retrans_dl:0.000000,tcp_retrans_ul:115.000000,udp_dl:956.480000,udp_ul:956.720000,udp_jitter_dl:0.016245,udp_jitter_ul:0.016770,udp_loss_dl:0.049220,udp_loss_ul:0.204588,ping:44.919000,ping_loss:0.000000});
addDataPoint({timestamp:'2025-11-28 13:29:33',tcp_dl:931.820000,tcp_ul:940.100000,tcp_retrans_dl:0.000000,tcp_retrans_ul:101.000000,udp_dl:956.280000,udp_ul:956.670000,udp_jitter_dl:0.013234,udp_jitter_ul:0.016406,udp_loss_dl:0.002823,udp_loss_ul:0.204539,ping:44.019000,ping_loss:0.000000});
addDataPoint({timestamp:'2025-11-28 13:30:18',tcp_dl:930.430000,tcp_ul:942.920000,tcp_retrans_dl:0.000000,tcp_retrans_ul:99.000000,udp_dl:955.690000,udp_ul:956.620000,udp_jitter_dl:0.019226,udp_jitter_ul:0.012919,udp_loss_dl:0.027042,udp_loss_ul:0.209806,ping:45.567000,ping_loss:0.000000});

renderCharts();
</script>
</body>
</html>